# 1. Base Image: Use Python 3.9 on Debian Slim (Small & Secure-ish)
FROM python:3.9-slim

# 2. Set the working directory inside the container
WORKDIR /app

# 3. Install system libraries (Required for Pillow/Nuympy processing)
# We clean up the apt cache afterwards to keep the image size down.
# 3. Install system libraries (Required for Pillow/Nuympy processing)
RUN apt-get update && apt-get install -y --no-install-recommends \
    libgl1 \
    libglib2.0-0 \
    && rm -rf /var/lib/apt/lists/*

# 4. Copy requirements first (Docker Caching Strategy)
# We do this BEFORE copying the code. If you change your code but not requirements,
# Docker skips this slow "pip install" step.
COPY python-app/requirements.txt .

# 5. Install Python Dependencies
RUN pip install --no-cache-dir -r requirements.txt

# 7. Copy the Model (Crucial Step)
# We copy from the "Build Context" (root folder) into the container
COPY models/mobilenetv2.onnx /models/mobilenetv2.onnx

# 6. Copy the Application Code
COPY python-app/main.py .


# 8. Expose the Port (Documentation only, but good practice)
EXPOSE 8000

# 9. The Command to Run the App
# --host 0.0.0.0 is vital! It lets the container accept outside traffic.
CMD ["uvicorn", "main:app", "--host", "0.0.0.0", "--port", "8000"]